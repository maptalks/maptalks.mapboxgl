/*!
 * maptalks.mapboxgl v0.3.4
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
/*!
 * requires maptalks@>=0.29.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks"),require("mapbox-gl")):"function"==typeof define&&define.amd?define(["exports","maptalks","mapbox-gl"],e):e(t.maptalks=t.maptalks||{},t.maptalks,t.mapboxgl)}(this,function(t,i,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var n=Object.getOwnPropertyNames(e),o=0;o<n.length;o++){var i=n[o],r=Object.getOwnPropertyDescriptor(e,i);r&&r.configurable&&void 0===t[i]&&Object.defineProperty(t,i,r)}}(t,e))}r=r&&r.hasOwnProperty("default")?r.default:r;var e=function(t){function e(){return n(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return o(e,t),e.fromJSON=function(t){return t&&"MapboxglLayer"===t.type?new e(t.id,t.options):null},e.prototype.getGlMap=function(){var t=this._getRenderer();return t?t.glmap:null},e.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},e}(i.Layer);e.mergeOptions({renderer:"dom",container:"back",glOptions:{style:"mapbox://styles/mapbox/streets-v9"}}),e.registerJSONType("MapboxglLayer"),e.registerRenderer("dom",function(){function e(t){n(this,e),this.layer=t}return e.prototype.getMap=function(){return this.layer?this.layer.getMap():null},e.prototype.show=function(){this._container&&(this.render(),this._show())},e.prototype.hide=function(){this._container&&(this._hide(),this.clear())},e.prototype.remove=function(){delete this.layer,this.glmap&&this.glmap.remove(),this._container&&i.DomUtil.removeDomNode(this._container),delete this._container,delete this.glmap},e.prototype.clear=function(){this._container&&(this._container.innerHTML="")},e.prototype.setZIndex=function(t){this._zIndex=t,this._container&&(this._container.style.zIndex=t)},e.prototype.needToRedraw=function(){var t=this.getMap(),e=t._getRenderer();return t.isInteracting()||e&&e.isViewChanged()},e.prototype.render=function(){var t=this;if(this._container||this._createLayerContainer(),!this.glmap){var e=this.getMap(),n=e.getCenter(),o=i.Util.extend({},this.layer.options.glOptions,{container:this._container,center:new r.LngLat(n.x,n.y),zoom:s(e.getResolution())});this.glmap=new r.Map(o),this.glmap.on("load",function(){t.layer.fire("layerload")})}this._syncMap()},e.prototype.drawOnInteracting=function(){var t=this.getMap();this.glmap&&t&&this._syncMap()},e.prototype.getEvents=function(){return{resize:this.onResize}},e.prototype.onResize=function(){this._resize()},e.prototype._createLayerContainer=function(){var t=this._container=i.DomUtil.createEl("div","maptalks-mapboxgllayer");t.style.cssText="position:absolute;",this._resize(),this._zIndex&&(t.style.zIndex=this._zIndex),("front"===this.layer.options.container?this.getMap()._panels.frontStatic:this.getMap()._panels.backStatic).appendChild(t)},e.prototype._resize=function(){var t=this._container;if(t){var e=this.getMap().getSize();t.style.width=e.width+"px",t.style.height=e.height+"px",this.glmap&&this.glmap.resize()}},e.prototype._show=function(){this._container.style.display=""},e.prototype._hide=function(){this._container.style.display="none"},e.prototype._syncMap=function(){var t=this.getMap();if(this.glmap&&t){var e=t.getCenter(),n={center:new r.LngLat(e.x,e.y),zoom:s(t.getResolution()),bearing:t.getBearing(),pitch:t.getPitch()};this.glmap.jumpTo(n)}},e}());var a=12756274*Math.PI/(256*Math.pow(2,20));function s(t){return 19-Math.log(t/a)/Math.LN2}t.MapboxglLayer=e,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.mapboxgl v0.3.4, requires maptalks@>=0.29.0.")});
